#
# @lc app=leetcode id=3534 lang=python3
#
# [3534] Path Existence Queries in a Graph II
#
from typing import List
import bisect
from math import ceil
# @lc code=start
class Solution:
    def pathExistenceQueries(self,
                             n: int,
                             nums: List[int],
                             max_dff: int,
                             queries: List[List[int]]) -> List[int]:
        # ----- Preprocessing -----
        # Sort indices by numeric values
        indexed = [(nums[i], i) for i in range(n)]
        indexed.sort()
        pos_to_id = [orig_id for _, orig_id in indexed]
        val_sorted = [val for val,_ in indexed]
        id_to_pos = [-1]*n
        for pos_id,(_,orig_id) in enumerate(indexed):
            id_to_pos[orig_id]=pos_id
        
        m=n               # m == len(val_sorted)
        LOG=int(ceil(m**.bit_length())) + 15     # enough bits ~20
        
        # Right-most neighbour (>pos)																							 	 	 	 	 	 	 	 	 	 	 	 	 	 	 	 	         . . . . . . . . . . . . . . . .. .. .. .. .. .. .. .. .. .. .. .. ... .... .... ...... ...... ........ ............. ............. ............. ............. ............. ............. ............. ............. ............. ............. ............. ............. ............. ............. .............. ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... ..... .... .... .... .... .... .... .... .... .... .... .... ... ... ... ... ... ... ... ... ... ... ... .. .. .. .. .. .. .. .. .. .. .. ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... ...... .....................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................#.....#.....#.....#.....#.....#.....#.....#.....#.....#.....#.....#.....#.....#.....#..#..#..#..#..#..#..#..#..#..#..#..#..#..#..#...........\.\...........\...........\...........\...........\...........\...........\...........\...........\...........\...........\...........\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\.......\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\...............\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\........................................\\\\\\\\\\\\\\\\..................................`````````````````````````````````                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               def get_r(idx):                base_val          ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;                ub                 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!""""""""""""""""""""""""""'''''''''''''''''''''''''''''''''''$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&&&&&&&&&&&&&&&&&&&(((((((((((((((((((((()))))))))))))))))))*******++++++++++++++,,,,,,,,,,,,,,,,,,,,,,-----------..........................//////////////////////////////00000000000000001111111111111111122222222222222222333333333333333333444444444444444444555555555555555555666666666666666666777777777777777777888888888888888888999999999999999999::::::::::::::::::::::::::::::::::::::<<<<<<<<<<<<<<<<<<===================>>>>>>>>>>>>>>>>>>???????????????????????????????@@@@@@@@@@@@@@@@@@@AAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBCCCCCCCCCCCCCCCCCDDDDDDDDDDDDDDDDDEEEEEEEEEEEEEEEEEFFFFFFFFFFFFFFFFFFGGGGGGGGGGGGGGGGGHHHHHHHHHHHHHHHHHIIIIIIIIIIIIIIIIIJJJJJJJJJJJJJJJJJKKKKKKKKKKKKKKKKKLLLLLLLLLLLLLLLLLMMMMMMMMMMMMMMMNNNNNNNNNNNNNNNNNOOOOOOOOOOOOOOOOOOPPPPPPPPPPPPPPPPPQQQQQQQQQQQQQQQQQRRRRRRRRRRRRRRRRRSSSSSSSSSSSSSSSSSTTTTTTTTTTTTTTTTTUUUUUUUUUUUUUUUUUVVVVVVVVVVVVVVVVVWWWWWWWWWWWWWWWWWXXXXXXXXXXXXXXXXXXXXYYYYYYYYYYYYYYYYYYZZZZZZZZZZZZZZZZZ[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]^^^^^^^^^^^^^^^^^^^^^^^^_____```aaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbccccccccccccccccddddddddddddddddeeeeeeeeeeeeeeeeffffffffffffffffgggggggggggggggghhhhhhhhhhhhhhhhiiiiiiiiiiiiiiiijjjjjjjjjjjjjjjkkkkkkkkkkkkkkkkllllllllllllllllmmmmmmmmmmmmmmmnnnnnnnnnnnnnnnooooooooooooooopppppppppppppppqqqqqqqqqqqqqqrrrrrrrrrrrrrrssssssssssssssstttttttttttttttuuuuuuuuuuuuuuuvvvvvvvvvvvvvvvwwwwwwwwwwwwwwwxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyzzzzzzzzzzzzzz{{{{{{{{{{{{{{{||||||||||||||}}}}}}}}}}}}}}}~~~~~~~~~~~~~~~                                                                                                                                